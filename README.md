# Blockchain_task_1
Группа: МПИ-22-1
Команда: Гунев Д., Белоус В., Игнатьев П.

Основной функционал контракта заключается в аренде компьютеров. Каждый токен представляет компьютер, и контракт позволяет пользователям арендовать компьютеры, оплачивая их использование в течение определенного времени.
В контракте определена структура Computer, которая содержит следующие поля:
    - name: имя компьютера;
    - owner: адрес владельца компьютера;
    - isRented: флаг, указывающий, арендован ли компьютер;
    - isRenterPay: флаг, указывающий, оплатил ли арендатор аренду;
    - rentPricePerMinute: стоимость аренды компьютера за минуту;
    - rentedUntil: время до окончания аренды (временная метка блокчейна);
    - processor: процессор компьютера;
    - memorySize: объем памяти компьютера;
    - graphicsCard: графическая карта компьютера;
    - ssdCapacity: объем SSD-накопителя компьютера;
    - renterPaymentAddress: адрес, указывающий на того, кто оплатил аренду компьютера.
Также в контракте определены массив computers, который содержит все компьютеры, и два словаря:
1) _computerName, который содержит имя компьютера по его идентификатору (тип mapping);
2) balances, который хранит баланс каждого пользователя (тип mapping).
Функции контракта:
1) Конструктор контракта принимает две строки (name и symbol) и вызывает конструктор базового ERC721 контракта с этими параметрами. Также контракт сделан платежеспособным (payable).
2) Функция mint используется для создания нового компьютера. Она принимает адрес, куда будет создан компьютер, а также различные параметры компьютера, такие как его имя, стоимость аренды, процессор, объем памяти, графическая карта и емкость SSD-накопителя.
3)  Функция rentByTime используется для аренды компьютера на определенное время. Она принимает идентификатор компьютера (tokenId) и адрес арендатора (to), куда будет передан ERC721-токен компьютера.
Вначале проверяются различные условия:
    - вызывающий контракт должен быть владельцем компьютера или иметь разрешение на его передачу;
    - компьютер не должен быть уже арендован;
    - арендатор должен уже оплатить предыдущую аренду;
    - баланс арендатора должен быть достаточным для оплаты аренды.
Затем выполняются следующие действия:
    - уменьшается баланс арендатора на стоимость аренды за минуту;
    - выполняется отправка средств владельцу компьютера в размере стоимости аренды за минуту;
    - устанавливается время окончания аренды компьютера (rentedUntil) на текущее время плюс 60 секунд;
    - флаг isRented компьютера устанавливается в значение true, говорящее о том, что компьютер был арендован;
    - ERC721-токен компьютера переводится с вызывающего контракта на адрес арендатора с помощью функции _transfer.
4)  Функция returnFromRent используется для возврата арендованного компьютера. Она принимает идентификатор компьютера (tokenId) и адрес владельца компьютера (from), который собирается вернуть компьютер.
Вначале выполняются следующие проверки:
    - адрес вызывающего контракта должен быть текущим владельцем компьютера;
    - компьютер должен быть арендован;
    - время аренды компьютера должно истечь (текущее время должно быть больше или равно времени окончания аренды).
После проверок выполняются следующие действия:
    - флаг isRented компьютера устанавливается в значение false, обозначая, что компьютер больше не арендован;
    - флаг isRenterPay компьютера также устанавливается в значение false;
    - ERC721-токен компьютера переводится с адреса временного владельца на адрес арендодателя _transfer.
5)  Функция isRented возвращает флаг, указывающий, арендован ли компьютер с указанным идентификатором (tokenId).
6)  Функция getComputerDetails возвращает подробную информацию о компьютере с указанным идентификатором (tokenId). Она возвращает имя компьютера, адрес владельца, флаги isRented и isRenterPay, стоимость аренды в минуту, время окончания аренды, характеристики компьютера (процессор, объем памяти, графическая карта, емкость SSD-накопителя) и адрес для оплаты аренды. Перед возвратом информации происходит проверка, существует ли компьютер с указанным идентификатором, с помощью функции _exists.
7) Функция getAllTokenIds возвращает массив всех идентификаторов токенов, которые были созданы в контракте.
8) Функция burn используется для удаления токена и связанной с ним информации. Она принимает идентификатор токена (tokenId).
Вначале выполняется проверка, что вызывающий контракт является владельцем токена или имеет разрешение на его удаление. Затем получается адрес владельца токена. Выполняются следующие проверки:
    - арендован ли компьютер с данным идентификатором;
    - затем вызывается функция _burn, которая удаляет токен из контракта ERC721;
    - после удаляются данные о компьютере и его имя из соответствующих маппингов;
    - далее выполняется итерация по массиву tokenIds, чтобы найти индекс удаляемого токена;
    - если найден индекс, то происходит сдвиг элементов влево для удаления идентификатора токена из массива;
    - в конце, метод pop вызывается для удаления последнего элемента массива tokenIds.
9) Функция refundRent используется для возврата оплаты аренды. Она принимает идентификатор токена (tokenId) и адрес для возврата платежа (paymentAddress). Выполняются следующие проверки:
    - вызывающий контракт должен быть владельцем токена;
    - арендатор должен быть оплатившим аренду;
    - затем вызывается функция call с указанием адреса для возврата платежа и суммы платежа, чтобы выполнить возврат средств;
    - если возврат произошел успешно, то выполняются следующие действия: уменьшается баланс адреса paymentAddress на стоимость аренды и флаг isRenterPay компьютера устанавливается в значение false, обозначая, что арендатор не оплатил аренду.
10)  Функция payRent используется для оплаты аренды. Она принимает идентификатор токена (tokenId). Выполняются следующие проверки:
    - компьютер с данным идентификатором не арендован;
    - вызывающий контракт не является владельцем токена;
    - значение msg.value должно быть равно стоимости аренды.
    - если проверки прошли успешно, то выполняются следующие действия:
    - значение msg.value сохраняется в переменной amount;
    - флаг isRenterPay компьютера устанавливается в значение true, обозначая, что арендатор оплатил аренду;
    - адрес арендатора сохраняется в переменной renterPaymentAddress компьютера;
    - увеличивается баланс адреса в массиве balances _msgSender() на сумму оплаты.
11)  Функция getBalances возвращает баланс указанного адреса.
12) Функция getComputerCount возвращает количество компьютеров, созданных в контракте.
